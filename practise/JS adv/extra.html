<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Management System</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        .is-invalid {
            border: 2px solid red;
        }
    </style>
</head>

<body class="container py-4">
    <h2 class="mb-3">Guest Registration Form</h2>

    <form id="customerForm" class="row g-3">
        <div class="col-md-6"><label class="form-label">Full Name</label>
            <input type="text" class="form-control" id="fullName" required>
        </div>
        <div class="col-md-6"><label class="form-label">Phone Number</label>
            <input type="number" class="form-control" id="phone" required>
        </div>
        <div class="col-md-6"><label class="form-label">Email</label>
            <input type="email" class="form-control" id="email" required>
        </div>
        <div class="col-md-6"><label class="form-label">Aadhar</label>
            <input type="number" class="form-control" id="aadhar" required>
        </div>
        <div class="col-md-12"><label class="form-label">Address</label>
            <textarea class="form-control" id="address" required></textarea>
        </div>
        <div class="col-md-6"><label class="form-label">Check-In</label>
            <input type="date" class="form-control" id="checkIn" required>
        </div>
        <div class="col-md-6"><label class="form-label">Check-Out</label>
            <input type="date" class="form-control" id="checkOut" required>
        </div>
        <div class="col-md-6"><label class="form-label">Adults</label>
            <input type="number" class="form-control" id="adults" required>
        </div>
        <div class="col-md-12"><label class="form-label">Purpose</label>
            <textarea class="form-control" id="purpose" required></textarea>
        </div>
        <div class="col-12">
            <button type="submit" class="btn btn-primary">Submit</button>
        </div>
    </form>
    <div id="messageBox" class="mt-3"></div>

    <h3 class="mt-5">Submissions</h3>
    <input type="text" id="search" class="form-control mb-2" placeholder="Search by Name or Date">
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Name</th>
                <th>Phone</th>
                <th>Email</th>
                <th>Aadhar</th>
                <th>Check-In</th>
                <th>Check-Out</th>
                <th>Adults</th>
                <th>Purpose</th>
                <th>Date</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="submissionTable"></tbody>
    </table>
    <div id="noData" class="text-danger fw-bold"></div>

    <script>
        class CustomerFormHandler {
            constructor() {
                this.form = document.getElementById("customerForm");
                this.messageBox = document.getElementById("messageBox");
                this.customers = JSON.parse(localStorage.getItem("customers")) || [];
                this.form.addEventListener("submit", e => { e.preventDefault(); if (this.validateForm()) { this.save(); this.show("Saved!", "success"); this.clear(); this.render(); } });
                this.form.addEventListener("input", e => this.validateField(e.target));
                this.render();
                document.getElementById("search").addEventListener("input", () => this.render());
            }
            validateField(el) {
                let v = el.value.trim(), ok = true;
                switch (el.id) {
                    case "fullName": ok = v.length >= 3; break;
                    case "phone": ok = /^\d{10}$/.test(v); break;
                    case "email": ok = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v); break;
                    case "aadhar": ok = /^\d{12}$/.test(v); break;
                    case "address": case "purpose": ok = v !== " "; break;
                    case "checkIn": case "checkOut": ok = new Date(v) >= new Date(); break;
                    case "adults": ok = +v > 0; break;
                }
                el.classList.toggle("is-invalid", !ok); return ok;
            }
            validateForm() { return [...this.form.elements].every(e => e.tagName === "BUTTON" || this.validateField(e)); }
            save() {
                let d = {
                    fullName: fullName.value, phone: phone.value, email: email.value, aadhar: aadhar.value, address: address.value,
                    checkIn: checkIn.value, checkOut: checkOut.value, adults: adults.value, purpose: purpose.value, date: new Date().toLocaleString()
                };
                this.customers.push(d); localStorage.setItem("customers", JSON.stringify(this.customers));
            }
            clear() { this.form.reset();[...this.form.elements].forEach(e => e.classList.remove("is-invalid")); }
            show(msg, t) { this.messageBox.innerHTML = <div class="alert alert-${t}">${msg}</div>; setTimeout(() => this.messageBox.innerHTML = "", 2000); }
            render() {
                let q = document.getElementById("search").value.toLowerCase();
                let data = this.customers.filter(c => c.fullName.toLowerCase().includes(q) || c.checkIn.includes(q) || c.checkOut.includes(q));
                let tb = document.getElementById("submissionTable"); tb.innerHTML = "";
                if (data.length === 0) { noData.textContent = "No data found"; return; } noData.textContent = "";
                data.forEach((c, i) => tb.innerHTML += `<tr><td>${c.fullName}</td><td>${c.phone}</td><td>${c.email}</td><td>${c.aadhar}</td>
      <td>${c.checkIn}</td><td>${c.checkOut}</td><td>${c.adults}</td><td>${c.purpose}</td><td>${c.date}</td>
      <td><button class="btn btn-danger btn-sm" onclick="app.del(${i})">Delete</button></td></tr>`);
            }
            del(i) { this.customers.splice(i, 1); localStorage.setItem("customers", JSON.stringify(this.customers)); this.render(); }
        }
        const app = new CustomerFormHandler();
    </script>
</body>

</html>